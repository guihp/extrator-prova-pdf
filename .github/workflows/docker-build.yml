name: Docker Build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Backend Docker Image
        run: |
          cd backend
          docker build -t analize-pdf-backend:latest .
      
      - name: Test Backend Image
        run: |
          docker run --rm analize-pdf-backend:latest python -c "import app; print('âœ… Backend OK')"

  build-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Frontend Docker Image
        run: |
          cd frontend
          docker build --build-arg VITE_API_URL=http://localhost:8000 -t analize-pdf-frontend:latest .
      
      - name: Test Frontend Image
        run: |
          docker run --rm -d -p 8080:80 --name test-frontend analize-pdf-frontend:latest
          sleep 5
          curl -f http://localhost:8080 || exit 1
          docker stop test-frontend

